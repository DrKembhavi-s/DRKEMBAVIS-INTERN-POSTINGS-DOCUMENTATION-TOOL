<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jain AGM Ayurvedic Medical College & Hospital - Intern Postings Documentation Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
        }

        .section h2::before {
            content: "â–¶";
            margin-right: 10px;
            color: #3498db;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #219a52);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .intern-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .intern-card {
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .intern-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .intern-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .intern-name {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .intern-reg {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .progress-bar {
            background: #ecf0f1;
            border-radius: 20px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            border-radius: 20px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .posting-item {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 10px;
            margin: 8px 0;
            border-left: 3px solid #3498db;
        }

        .posting-dept {
            font-weight: 600;
            color: #2c3e50;
        }

        .posting-dates {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 3px;
        }

        .posting-days {
            font-size: 0.85rem;
            color: #27ae60;
            font-weight: 600;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-pending {
            background: #fef9e7;
            color: #f39c12;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            padding: 8px 15px;
            font-size: 0.8rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #000;
        }

        .department-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 15px;
        }

        .signature-section {
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            background: #fdfdfd;
        }

        .signature-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 40px;
        }

        .signature-line {
            border-top: 2px solid #2c3e50;
            width: 200px;
            margin: 0 auto 10px;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .department-row {
                grid-template-columns: 1fr;
            }
            
            .intern-list {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                justify-content: center;
            }
            
            .export-buttons {
                flex-direction: column;
                align-items: center;
            }
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #3498db;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .search-filter {
            margin-bottom: 20px;
        }

        .search-filter input {
            width: 100%;
            max-width: 400px;
        }

        @media print {
            body { background: white; }
            .container { box-shadow: none; }
            .btn { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR</h1>
            <p>INTERN POSTINGS DOCUMENTATION TOOL</p>
        </div>

        <div class="main-content">
            <!-- Add New Intern Section -->
            <div class="section">
                <h2>Add New Intern</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="internName">Intern Name *</label>
                        <input type="text" id="internName" required>
                    </div>
                    <div class="form-group">
                        <label for="internRegNo">Registration Number *</label>
                        <input type="text" id="internRegNo" required>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addIntern()">Add Intern</button>
            </div>

            <!-- Summary Statistics -->
            <div class="section">
                <h2>Summary Statistics</h2>
                <div class="summary-stats" id="summaryStats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalInterns">0</div>
                        <div class="stat-label">Total Interns</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedInterns">0</div>
                        <div class="stat-label">Completed (365 days)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pendingInterns">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="avgProgress">0%</div>
                        <div class="stat-label">Average Progress</div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="section">
                <h2>Manage Interns</h2>
                <div class="search-filter">
                    <input type="text" id="searchIntern" placeholder="Search by name or registration number..." 
                           oninput="filterInterns()" style="width: 100%; max-width: 400px;">
                </div>
                
                <div class="export-buttons">
                    <button class="btn btn-success" onclick="exportAllData()">Export All Data (JSON)</button>
                    <button class="btn btn-secondary" onclick="importData()">Import Data (JSON)</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
                    <button class="btn btn-primary" onclick="generateMasterReport()">Generate Master Report</button>
                </div>

                <div class="intern-list" id="internList"></div>
            </div>
        </div>
    </div>

    <!-- Add Posting Modal -->
    <div id="addPostingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Add Department Posting</h2>
            <div id="modalInternInfo" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;"></div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="postingDept">Department *</label>
                    <select id="postingDept" required>
                        <option value="">Select Department</option>
                        <option value="KAYACHIKITSA">KAYACHIKITSA (KC)</option>
                        <option value="SHALYA TANTRA">SHALYA TANTRA (ST)</option>
                        <option value="SHALAKYA TANTRA">SHALAKYA TANTRA (SKT)</option>
                        <option value="PANCHAKARMA">PANCHAKARMA (PK)</option>
                        <option value="PRASUTI TANTRA & STREE ROGA">PRASUTI TANTRA & STREE ROGA (PTSR)</option>
                        <option value="KAUMARABHRITYA">KAUMARABHRITYA (KB)</option>
                        <option value="LABORATORY">LABORATORY (LAB)</option>
                        <option value="PHARMACY">PHARMACY</option>
                        <option value="ATYAYIKA">ATYAYIKA</option>
                        <option value="AYUSH">AYUSH</option>
                        <option value="SCREENING">SCREENING</option>
                        <option value="OTHER HOSPITALS">OTHER HOSPITALS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="postingFromDate">From Date *</label>
                    <input type="date" id="postingFromDate" required>
                </div>
                <div class="form-group">
                    <label for="postingToDate">To Date *</label>
                    <input type="date" id="postingToDate" required>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
                <button class="btn btn-primary" onclick="savePosting()">Save Posting</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Individual Report Modal -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReportModal()">&times;</span>
            <div id="reportContent"></div>
        </div>
    </div>

    <script>
        let interns = JSON.parse(localStorage.getItem('internData') || '[]');
        let currentInternId = null;

        // Department codes mapping
        const deptCodes = {
            'KAYACHIKITSA': 'KC',
            'SHALYA TANTRA': 'ST',
            'SHALAKYA TANTRA': 'SKT',
            'PANCHAKARMA': 'PK',
            'PRASUTI TANTRA & STREE ROGA': 'PTSR',
            'KAUMARABHRITYA': 'KB',
            'LABORATORY': 'LAB',
            'PHARMACY': 'PHM',
            'ATYAYIKA': 'ATY',
            'AYUSH': 'AYU',
            'SCREENING': 'SCR',
            'OTHER HOSPITALS': 'OTH'
        };

        function addIntern() {
            const name = document.getElementById('internName').value.trim();
            const regNo = document.getElementById('internRegNo').value.trim();
            
            if (!name || !regNo) {
                alert('Please fill in both name and registration number.');
                return;
            }

            // Check for duplicate registration number
            if (interns.some(intern => intern.regNo === regNo)) {
                alert('Registration number already exists!');
                return;
            }

            const intern = {
                id: Date.now(),
                name: name,
                regNo: regNo,
                postings: [],
                totalDays: 0,
                createdDate: new Date().toISOString()
            };

            interns.push(intern);
            saveData();
            renderInterns();
            updateSummaryStats();
            
            // Clear form
            document.getElementById('internName').value = '';
            document.getElementById('internRegNo').value = '';
            
            alert('Intern added successfully!');
        }

        function calculateDays(fromDate, toDate) {
            const start = new Date(fromDate);
            const end = new Date(toDate);
            const timeDiff = end.getTime() - start.getTime();
            return Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1; // +1 to include both start and end dates
        }

        function openAddPostingModal(internId) {
            currentInternId = internId;
            const intern = interns.find(i => i.id === internId);
            
            document.getElementById('modalInternInfo').innerHTML = `
                <strong>Adding posting for:</strong> ${intern.name} (${intern.regNo})
            `;
            
            document.getElementById('addPostingModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('addPostingModal').style.display = 'block';
            document.getElementById('postingDept').value = '';
            document.getElementById('postingFromDate').value = '';
            document.getElementById('postingToDate').value = '';
            currentInternId = null;
        }

        function savePosting() {
            const dept = document.getElementById('postingDept').value;
            const fromDate = document.getElementById('postingFromDate').value;
            const toDate = document.getElementById('postingToDate').value;

            if (!dept || !fromDate || !toDate) {
                alert('Please fill in all fields.');
                return;
            }

            if (new Date(fromDate) > new Date(toDate)) {
                alert('From date cannot be later than to date.');
                return;
            }

            const intern = interns.find(i => i.id === currentInternId);
            
            // Check if department already has a posting
            if (intern.postings.some(p => p.department === dept)) {
                alert('This intern already has a posting in this department.');
                return;
            }

            const days = calculateDays(fromDate, toDate);
            
            const posting = {
                id: Date.now(),
                department: dept,
                fromDate: fromDate,
                toDate: toDate,
                days: days
            };

            intern.postings.push(posting);
            intern.totalDays = intern.postings.reduce((sum, p) => sum + p.days, 0);

            saveData();
            renderInterns();
            updateSummaryStats();
            closeModal();
            
            alert(`Posting added successfully! ${days} days recorded.`);
        }

        function deletePosting(internId, postingId) {
            if (confirm('Are you sure you want to delete this posting?')) {
                const intern = interns.find(i => i.id === internId);
                intern.postings = intern.postings.filter(p => p.id !== postingId);
                intern.totalDays = intern.postings.reduce((sum, p) => sum + p.days, 0);
                
                saveData();
                renderInterns();
                updateSummaryStats();
            }
        }

        function deleteIntern(internId) {
            if (confirm('Are you sure you want to delete this intern and all their postings?')) {
                interns = interns.filter(i => i.id !== internId);
                saveData();
                renderInterns();
                updateSummaryStats();
            }
        }

        function generateReport(internId) {
            const intern = interns.find(i => i.id === internId);
            const progress = (intern.totalDays / 365) * 100;
            const remainingDays = Math.max(0, 365 - intern.totalDays);
            
            const reportContent = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
                    <div style="text-align: center; border-bottom: 3px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #2c3e50; margin-bottom: 10px;">JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR</h1>
                        <h2 style="color: #3498db; margin-bottom: 5px;">INTERNSHIP COMPLETION CERTIFICATE</h2>
                        <p style="color: #7f8c8d;">Official Documentation of Rotational Internship</p>
                    </div>

                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <h3 style="color: #2c3e50; margin-bottom: 15px;">INTERN DETAILS</h3>
                        <p><strong>Name:</strong> ${intern.name}</p>
                        <p><strong>Registration Number:</strong> ${intern.regNo}</p>
                        <p><strong>Total Days Completed:</strong> ${intern.totalDays} days</p>
                        <p><strong>Remaining Days:</strong> ${remainingDays} days</p>
                        <p><strong>Completion Status:</strong> 
                            <span style="color: ${intern.totalDays >= 365 ? '#27ae60' : '#f39c12'}; font-weight: bold;">
                                ${intern.totalDays >= 365 ? 'COMPLETED' : 'PENDING'}
                            </span>
                        </p>
                        <p><strong>Progress:</strong> ${progress.toFixed(1)}%</p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">DEPARTMENT-wise POSTING DETAILS</h3>
                        ${intern.postings.map(posting => `
                            <div style="background: white; border: 1px solid #e1e8ed; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #3498db;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <strong style="color: #2c3e50; font-size: 1.1em;">${posting.department}</strong>
                                    <span style="background: #3498db; color: white; padding: 4px 10px; border-radius: 15px; font-size: 0.9em;">${posting.days} days</span>
                                </div>
                                <p style="color: #7f8c8d; margin: 5px 0;">
                                    <strong>Period:</strong> ${new Date(posting.fromDate).toLocaleDateString()} to ${new Date(posting.toDate).toLocaleDateString()}
                                </p>
                                <div style="margin-top: 15px; text-align: center;">
                                    <div style="border-top: 2px solid #2c3e50; width: 200px; margin: 0 auto;"></div>
                                    <p style="margin-top: 8px; font-size: 0.9em; color: #2c3e50;"><strong>HOD Signature & Date</strong></p>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 40px 0;">
                        <div style="text-align: center;">
                            <div style="border-top: 2px solid #2c3e50; width: 200px; margin: 0 auto 10px;"></div>
                            <p style="font-weight: bold; color: #2c3e50;">MEDICAL SUPERINTENDENT</p>
                            <p style="color: #7f8c8d; font-size: 0.9em;">Signature & Date</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="border-top: 2px solid #2c3e50; width: 200px; margin: 0 auto 10px;"></div>
                            <p style="font-weight: bold; color: #2c3e50;">PRINCIPAL</p>
                            <p style="color: #7f8c8d; font-size: 0.9em;">Signature & Date</p>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 30px 0; padding: 20px; background: #ecf0f1; border-radius: 10px;">
                        <p style="font-weight: bold; color: #2c3e50; font-size: 1.1em;">THIS IS AN OFFICIAL DOCUMENT OF THE COLLEGE</p>
                        <p style="color: #7f8c8d; margin-top: 10px;">The details mentioned above are officially verified and authenticated.</p>
                        <p style="color: #7f8c8d; font-size: 0.9em; margin-top: 10px;">
                            Generated on: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
                        </p>
                    </div>
                </div>
            `;

            document.getElementById('reportContent').innerHTML = reportContent;
            document.getElementById('reportModal').style.display = 'block';
        }

        function closeReportModal() {
            document.getElementById('reportModal').style.display = 'none';
        }

        function downloadReport(internId, format) {
            const intern = interns.find(i => i.id === internId);
            if (!intern) return;

            if (format === 'html') {
                generateReport(internId);
                setTimeout(() => {
                    const content = document.getElementById('reportContent').innerHTML;
                    const blob = new Blob([`
                        <!DOCTYPE html>
                        <html><head><meta charset="UTF-8"><title>${intern.name} - Internship Report</title></head>
                        <body>${content}</body></html>
                    `], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${intern.name}_${intern.regNo}_Internship_Report.html`;
                    a.click();
                    URL.revokeObjectURL(url);
                    closeReportModal();
                }, 100);
            } else if (format === 'json') {
                const data = {
                    intern: intern,
                    generatedOn: new Date().toISOString(),
                    college: "JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR"
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${intern.name}_${intern.regNo}_Data.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        function renderInterns() {
            const container = document.getElementById('internList');
            const searchTerm = document.getElementById('searchIntern').value.toLowerCase();
            
            const filteredInterns = interns.filter(intern => 
                intern.name.toLowerCase().includes(searchTerm) || 
                intern.regNo.toLowerCase().includes(searchTerm)
            );

            if (filteredInterns.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #7f8c8d; font-style: italic;">No interns found.</p>';
                return;
            }

            container.innerHTML = filteredInterns.map(intern => {
                const progress = (intern.totalDays / 365) * 100;
                const isCompleted = intern.totalDays >= 365;
                const remainingDays = Math.max(0, 365 - intern.totalDays);

                return `
                    <div class="intern-card">
                        <div class="intern-header">
                            <div>
                                <div class="intern-name">${intern.name}</div>
                                <div class="intern-reg">Reg: ${intern.regNo}</div>
                            </div>
                            <span class="status-badge ${isCompleted ? 'status-completed' : 'status-pending'}">
                                ${isCompleted ? 'COMPLETED' : 'PENDING'}
                            </span>
                        </div>

                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(progress, 100)}%">
                                ${Math.round(progress)}%
                            </div>
                        </div>

                        <div style="margin: 10px 0;">
                            <strong>Total Days:</strong> ${intern.totalDays}/365 days<br>
                            ${!isCompleted ? `<strong>Remaining:</strong> ${remainingDays} days<br>` : ''}
                            <strong>Departments Posted:</strong> ${intern.postings.length}/12
                        </div>

                        <div style="max-height: 200px; overflow-y: auto;">
                            ${intern.postings.map(posting => `
                                <div class="posting-item">
                                    <div class="posting-dept">${posting.department}</div>
                                    <div class="posting-dates">
                                        ${new Date(posting.fromDate).toLocaleDateString()} - 
                                        ${new Date(posting.toDate).toLocaleDateString()}
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span class="posting-days">${posting.days} days</span>
                                        <button class="btn btn-danger" style="padding: 2px 8px; font-size: 0.7rem;" 
                                                onclick="deletePosting(${intern.id}, ${posting.id})">Delete</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openAddPostingModal(${intern.id})">Add Posting</button>
                            <button class="btn btn-success" onclick="generateReport(${intern.id})">View Report</button>
                            <button class="btn btn-secondary" onclick="downloadReport(${intern.id}, 'html')">Download HTML</button>
                            <button class="btn btn-secondary" onclick="downloadReport(${intern.id}, 'json')">Download JSON</button>
                            <button class="btn btn-danger" onclick="deleteIntern(${intern.id})">Delete Intern</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterInterns() {
            renderInterns();
        }

        function updateSummaryStats() {
            const total = interns.length;
            const completed = interns.filter(i => i.totalDays >= 365).length;
            const pending = total - completed;
            const avgProgress = total > 0 ? (interns.reduce((sum, i) => sum + Math.min((i.totalDays / 365) * 100, 100), 0) / total) : 0;

            document.getElementById('totalInterns').textContent = total;
            document.getElementById('completedInterns').textContent = completed;
            document.getElementById('pendingInterns').textContent = pending;
            document.getElementById('avgProgress').textContent = `${avgProgress.toFixed(1)}%`;
        }

        function saveData() {
            localStorage.setItem('internData', JSON.stringify(interns));
        }

        function exportAllData() {
            const data = {
                interns: interns,
                exportedOn: new Date().toISOString(),
                college: "JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR",
                version: "1.0"
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Intern_Data_Backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.interns && Array.isArray(data.interns)) {
                        if (confirm('This will replace all current data. Are you sure?')) {
                            interns = data.interns;
                            saveData();
                            renderInterns();
                            updateSummaryStats();
                            alert('Data imported successfully!');
                        }
                    } else {
                        alert('Invalid file format. Please select a valid backup file.');
                    }
                } catch (error) {
                    alert('Error reading file. Please check the file format.');
                }
            };
            reader.readAsText(file);
        }

        function generateMasterReport() {
            const masterReportContent = `
                <div style="font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px;">
                    <div style="text-align: center; border-bottom: 3px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #2c3e50; margin-bottom: 10px;">JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR</h1>
                        <h2 style="color: #3498db; margin-bottom: 5px;">MASTER INTERNSHIP REPORT</h2>
                        <p style="color: #7f8c8d;">Complete Overview of All Intern Postings</p>
                        <p style="color: #7f8c8d;">Generated on: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #3498db; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; font-weight: bold;">${interns.length}</div>
                            <div>Total Interns</div>
                        </div>
                        <div style="background: #27ae60; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; font-weight: bold;">${interns.filter(i => i.totalDays >= 365).length}</div>
                            <div>Completed</div>
                        </div>
                        <div style="background: #f39c12; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; font-weight: bold;">${interns.filter(i => i.totalDays < 365).length}</div>
                            <div>Pending</div>
                        </div>
                        <div style="background: #9b59b6; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; font-weight: bold;">${(interns.reduce((sum, i) => sum + Math.min((i.totalDays / 365) * 100, 100), 0) / (interns.length || 1)).toFixed(1)}%</div>
                            <div>Avg Progress</div>
                        </div>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">DETAILED INTERN LISTING</h3>
                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <thead style="background: #2c3e50; color: white;">
                                <tr>
                                    <th style="padding: 15px; text-align: left;">Name</th>
                                    <th style="padding: 15px; text-align: left;">Reg No</th>
                                    <th style="padding: 15px; text-align: center;">Total Days</th>
                                    <th style="padding: 15px; text-align: center;">Progress</th>
                                    <th style="padding: 15px; text-align: center;">Status</th>
                                    <th style="padding: 15px; text-align: center;">Departments</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${interns.map((intern, index) => {
                                    const progress = (intern.totalDays / 365) * 100;
                                    const isCompleted = intern.totalDays >= 365;
                                    return `
                                        <tr style="border-bottom: 1px solid #e1e8ed; ${index % 2 === 0 ? 'background: #f8f9fa;' : ''}">
                                            <td style="padding: 12px; font-weight: bold;">${intern.name}</td>
                                            <td style="padding: 12px;">${intern.regNo}</td>
                                            <td style="padding: 12px; text-align: center;">${intern.totalDays}/365</td>
                                            <td style="padding: 12px; text-align: center;">
                                                <div style="background: #ecf0f1; border-radius: 10px; height: 20px; width: 80px; margin: 0 auto; overflow: hidden;">
                                                    <div style="background: ${isCompleted ? '#27ae60' : '#3498db'}; height: 100%; width: ${Math.min(progress, 100)}%; border-radius: 10px;"></div>
                                                </div>
                                                <small>${Math.round(progress)}%</small>
                                            </td>
                                            <td style="padding: 12px; text-align: center;">
                                                <span style="padding: 5px 10px; border-radius: 15px; font-size: 0.8em; font-weight: bold; ${isCompleted ? 'background: #d5f4e6; color: #27ae60;' : 'background: #fef9e7; color: #f39c12;'}">
                                                    ${isCompleted ? 'COMPLETED' : 'PENDING'}
                                                </span>
                                            </td>
                                            <td style="padding: 12px; text-align: center;">${intern.postings.length}/12</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 40px 0;">
                        <div style="text-align: center;">
                            <div style="border-top: 2px solid #2c3e50; width: 200px; margin: 0 auto 10px;"></div>
                            <p style="font-weight: bold; color: #2c3e50;">MEDICAL SUPERINTENDENT</p>
                            <p style="color: #7f8c8d; font-size: 0.9em;">Signature & Date</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="border-top: 2px solid #2c3e50; width: 200px; margin: 0 auto 10px;"></div>
                            <p style="font-weight: bold; color: #2c3e50;">PRINCIPAL</p>
                            <p style="color: #7f8c8d; font-size: 0.9em;">Signature & Date</p>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 30px 0; padding: 20px; background: #ecf0f1; border-radius: 10px;">
                        <p style="font-weight: bold; color: #2c3e50; font-size: 1.1em;">THIS IS AN OFFICIAL DOCUMENT OF THE COLLEGE</p>
                        <p style="color: #7f8c8d; margin-top: 10px;">The details mentioned above are officially verified and authenticated.</p>
                    </div>
                </div>
            `;

            document.getElementById('reportContent').innerHTML = masterReportContent;
            document.getElementById('reportModal').style.display = 'block';
            
            setTimeout(() => {
                const content = document.getElementById('reportContent').innerHTML;
                const blob = new Blob([`
                    <!DOCTYPE html>
                    <html><head><meta charset="UTF-8"><title>Master Internship Report</title></head>
                    <body>${content}</body></html>
                `], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Master_Internship_Report_${new Date().toISOString().split('T')[0]}.html`;
                a.click();
                URL.revokeObjectURL(url);
                closeReportModal();
            }, 100);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            renderInterns();
            updateSummaryStats();
            
            // Close modals when clicking outside
            window.onclick = function(event) {
                const addModal = document.getElementById('addPostingModal');
                const reportModal = document.getElementById('reportModal');
                if (event.target == addModal) {
                    closeModal();
                }
                if (event.target == reportModal) {
                    closeReportModal();
                }
            };

            // Add keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    closeReportModal();
                }
            });
        });
    </script>
</body>
</html>
