<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jain AGM Ayurvedic Medical College & Hospital - Intern Postings Documentation Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
        }

        .section h2::before {
            content: "▶";
            margin-right: 10px;
            color: #3498db;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        input, select {
            padding: 12px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #219a52);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .view-toggle button {
            padding: 10px 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .view-toggle button.active {
            background: #3498db;
            color: white;
        }

        .login-section {
            background: #e8f5e8;
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .admin-login-section {
            background: #e8f8ff;
            border: 2px solid #3498db;
        }

        .hod-login-section {
            background: #e8f5e8;
            border: 2px solid #27ae60;
        }

        .login-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .panel {
            background: #f0f8ff;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .panel-welcome {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .intern-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .intern-card {
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .intern-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .intern-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .intern-name {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .intern-reg {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .progress-bar {
            background: #ecf0f1;
            border-radius: 20px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            border-radius: 20px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed {
            background: #d5f4e6;
            color: #27ae60;
        }

        .status-pending {
            background: #fef9e7;
            color: #f39c12;
        }

        .verification-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .verified {
            background: #d5f4e6;
            color: #27ae60;
        }

        .not-verified {
            background: #fef9e7;
            color: #f39c12;
        }

        .posting-item {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 10px;
            margin: 8px 0;
            border-left: 3px solid #3498db;
        }

        .posting-dept {
            font-weight: 600;
            color: #2c3e50;
        }

        .posting-dates {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 3px;
        }

        .posting-days {
            font-size: 0.85rem;
            color: #27ae60;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            padding: 8px 15px;
            font-size: 0.8rem;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #3498db;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #000;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }

        .letter-list-item {
            border: 1px solid #e1e8ed;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        @media (max-width: 768px) {
            .form-grid, .login-form {
                grid-template-columns: 1fr;
            }
            
            .intern-list {
                grid-template-columns: 1fr;
            }
            
            .export-buttons, .action-buttons {
                flex-direction: column;
                align-items: center;
            }
        }

        @media print {
            body { background: white; }
            .container { box-shadow: none; }
            .btn { display: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR</h1>
            <p>INTERN POSTINGS DOCUMENTATION TOOL</p>
        </div>

        <div class="main-content">
            <!-- View Toggle -->
            <div class="view-toggle">
                <button id="adminViewBtn" class="active" onclick="switchView('admin')">Admin Login</button>
                <button id="hodViewBtn" onclick="switchView('hod')">HOD Login</button>
            </div>

            <!-- Admin Login Section -->
            <div id="adminLoginSection" class="login-section admin-login-section">
                <h3 style="color: #3498db; margin-bottom: 15px;">Admin Login</h3>
                <div class="login-form">
                    <div class="form-group">
                        <label for="adminUsername">Username</label>
                        <input type="text" id="adminUsername" placeholder="e.g., admin">
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Password</label>
                        <input type="password" id="adminPassword" placeholder="Enter password">
                    </div>
                    <button class="btn btn-primary" onclick="adminLogin()">Login</button>
                </div>
                <div id="adminLoginError" style="color: #e74c3c; margin-top: 10px; display: none;"></div>
            </div>

            <!-- HOD Login Section -->
            <div id="hodLoginSection" class="login-section hod-login-section" style="display: none;">
                <h3 style="color: #27ae60; margin-bottom: 15px;">HOD Login</h3>
                <div class="login-form">
                    <div class="form-group">
                        <label for="hodUsername">Username</label>
                        <input type="text" id="hodUsername" placeholder="e.g., hodkc">
                    </div>
                    <div class="form-group">
                        <label for="hodPassword">Password</label>
                        <input type="password" id="hodPassword" placeholder="e.g., kc2025">
                    </div>
                    <button class="btn btn-success" onclick="hodLogin()">Login</button>
                </div>
                <div id="hodLoginError" style="color: #e74c3c; margin-top: 10px; display: none;"></div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" class="panel" style="display: none;">
                <div class="panel-welcome">
                    Welcome, <span id="adminRoleName"></span>
                    <button class="btn btn-danger" onclick="adminLogout()" style="float: right; padding: 5px 15px; font-size: 0.8rem;">Logout</button>
                </div>
            </div>

            <!-- HOD Panel -->
            <div id="hodPanel" class="panel" style="display: none; background: #f0f8f0; border-color: #27ae60;">
                <div class="panel-welcome">
                    Welcome, <span id="hodDeptName"></span> HOD
                    <button class="btn btn-danger" onclick="hodLogout()" style="float: right; padding: 5px 15px; font-size: 0.8rem;">Logout</button>
                </div>
                <div id="hodPostings"></div>
            </div>

            <!-- Admin Sections -->
            <div id="adminSections" style="display: none;">
                <!-- Posting Letters Generation Section -->
                <div class="section">
                    <h2>Generate Posting Letters</h2>
                    <p style="color: #7f8c8d; margin-bottom: 20px;">Generate official posting letters from Medical Superintendent to HODs for upcoming intern postings.</p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="letterInternName">Intern Name *</label>
                            <input type="text" id="letterInternName" required>
                        </div>
                        <div class="form-group">
                            <label for="letterInternRegNo">Registration Number *</label>
                            <input type="text" id="letterInternRegNo" required>
                        </div>
                        <div class="form-group">
                            <label for="letterDept">Department *</label>
                            <select id="letterDept" required>
                                <option value="">Select Department</option>
                                <option value="KAYACHIKITSA">KAYACHIKITSA (KC)</option>
                                <option value="SHALYA TANTRA">SHALYA TANTRA (ST)</option>
                                <option value="SHALAKYA TANTRA">SHALAKYA TANTRA (SKT)</option>
                                <option value="PANCHAKARMA">PANCHAKARMA (PK)</option>
                                <option value="PRASUTI TANTRA & STREE ROGA">PRASUTI TANTRA & STREE ROGA (PTSR)</option>
                                <option value="KAUMARABHRITYA">KAUMARABHRITYA (KB)</option>
                                <option value="LABORATORY">LABORATORY (LAB)</option>
                                <option value="PHARMACY">PHARMACY (PHM)</option>
                                <option value="ATYAYIKA">ATYAYIKA (ATY)</option>
                                <option value="AYUSH">AYUSH (AYU)</option>
                                <option value="SCREENING">SCREENING (SCR)</option>
                                <option value="OTHER HOSPITALS">OTHER HOSPITALS (OTH)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="letterFromDate">From Date *</label>
                            <input type="date" id="letterFromDate" required>
                        </div>
                        <div class="form-group">
                            <label for="letterToDate">To Date *</label>
                            <input type="date" id="letterToDate" required>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="generateSingleLetter()">Generate Single Letter</button>
                        <button class="btn btn-success" onclick="addToLetterList()">Add to Letter List</button>
                        <button class="btn btn-secondary" onclick="clearLetterForm()">Clear Form</button>
                    </div>

                    <div id="letterListSection" style="display: none; margin-top: 30px;">
                        <h3 style="color: #2c3e50; margin-bottom: 15px;">Batch Letter Generation</h3>
                        <div id="letterList" style="background: white; border-radius: 8px; padding: 15px; max-height: 300px; overflow-y: auto;"></div>
                        <div style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="generateBatchLetters()">Generate Individual Letters for All</button>
                            <button class="btn btn-primary" onclick="generateDepartmentBatchLetters()">Generate Batch Letters by Department</button>
                            <button class="btn btn-danger" onclick="clearLetterList()">Clear All</button>
                        </div>
                    </div>
                </div>

                <!-- Add New Intern Section -->
                <div class="section">
                    <h2>Add New Intern</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="internName">Intern Name *</label>
                            <input type="text" id="internName" required>
                        </div>
                        <div class="form-group">
                            <label for="internRegNo">Registration Number *</label>
                            <input type="text" id="internRegNo" required>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addIntern()">Add Intern</button>
                </div>

                <!-- Summary Statistics -->
                <div class="section">
                    <h2>Summary Statistics</h2>
                    <div class="summary-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalInterns">0</div>
                            <div class="stat-label">Total Interns</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="completedInterns">0</div>
                            <div class="stat-label">Completed (365 days)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="pendingInterns">0</div>
                            <div class="stat-label">Pending</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgProgress">0%</div>
                            <div class="stat-label">Average Progress</div>
                        </div>
                    </div>
                </div>

                <!-- Manage Interns -->
                <div class="section">
                    <h2>Manage Interns</h2>
                    <div style="margin-bottom: 20px;">
                        <input type="text" id="searchIntern" placeholder="Search by name or registration number..." 
                               oninput="filterInterns()" style="width: 100%; max-width: 400px;">
                    </div>
                    
                    <div class="export-buttons">
                        <button class="btn btn-success" onclick="exportAllData()">Export All Data (JSON)</button>
                        <button class="btn btn-secondary" onclick="importData()">Import Data (JSON)</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
                        <button class="btn btn-primary" onclick="generateMasterReport()">Generate Master Report</button>
                    </div>

                    <div class="intern-list" id="internList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Posting Modal -->
    <div id="addPostingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Add Department Posting</h2>
            <div id="modalInternInfo" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;"></div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="postingDept">Department *</label>
                    <select id="postingDept" required>
                        <option value="">Select Department</option>
                        <option value="KAYACHIKITSA">KAYACHIKITSA (KC)</option>
                        <option value="SHALYA TANTRA">SHALYA TANTRA (ST)</option>
                        <option value="SHALAKYA TANTRA">SHALAKYA TANTRA (SKT)</option>
                        <option value="PANCHAKARMA">PANCHAKARMA (PK)</option>
                        <option value="PRASUTI TANTRA & STREE ROGA">PRASUTI TANTRA & STREE ROGA (PTSR)</option>
                        <option value="KAUMARABHRITYA">KAUMARABHRITYA (KB)</option>
                        <option value="LABORATORY">LABORATORY (LAB)</option>
                        <option value="PHARMACY">PHARMACY (PHM)</option>
                        <option value="ATYAYIKA">ATYAYIKA (ATY)</option>
                        <option value="AYUSH">AYUSH (AYU)</option>
                        <option value="SCREENING">SCREENING (SCR)</option>
                        <option value="OTHER HOSPITALS">OTHER HOSPITALS (OTH)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="postingFromDate">From Date *</label>
                    <input type="date" id="postingFromDate" required>
                </div>
                <div class="form-group">
                    <label for="postingToDate">To Date *</label>
                    <input type="date" id="postingToDate" required>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
                <button class="btn btn-primary" onclick="savePosting()">Save Posting</button>
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Individual Report Modal -->
    <div id="reportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReportModal()">&times;</span>
            <div id="reportContent"></div>
        </div>
    </div>

    <script>
        // Global variables
        let interns = JSON.parse(localStorage.getItem('internData') || '[]');
        let currentInternId = null;
        let currentView = 'admin';
        let currentHOD = null;
        let currentAdmin = null;
        let letterList = [];

        // Admin credentials
        const adminCredentials = {
            'admin': { password: 'admin2025', role: 'Administrator' },
            'medsup': { password: 'ms2025', role: 'Medical Superintendent' },
            'principal': { password: 'prin2025', role: 'Principal' }
        };

        // HOD credentials
        const hodCredentials = {
            'hodkc': { password: 'kc2025', department: 'KAYACHIKITSA', displayName: 'KAYACHIKITSA' },
            'hodst': { password: 'st2025', department: 'SHALYA TANTRA', displayName: 'SHALYA TANTRA' },
            'hodskt': { password: 'skt2025', department: 'SHALAKYA TANTRA', displayName: 'SHALAKYA TANTRA' },
            'hodpk': { password: 'pk2025', department: 'PANCHAKARMA', displayName: 'PANCHAKARMA' },
            'hodptsr': { password: 'ptsr2025', department: 'PRASUTI TANTRA & STREE ROGA', displayName: 'PRASUTI TANTRA & STREE ROGA' },
            'hodkb': { password: 'kb2025', department: 'KAUMARABHRITYA', displayName: 'KAUMARABHRITYA' },
            'hodlab': { password: 'lab2025', department: 'LABORATORY', displayName: 'LABORATORY' },
            'hodphm': { password: 'phm2025', department: 'PHARMACY', displayName: 'PHARMACY' },
            'hodaty': { password: 'aty2025', department: 'ATYAYIKA', displayName: 'ATYAYIKA' },
            'hodayu': { password: 'ayu2025', department: 'AYUSH', displayName: 'AYUSH' },
            'hodscr': { password: 'scr2025', department: 'SCREENING', displayName: 'SCREENING' },
            'hodoth': { password: 'oth2025', department: 'OTHER HOSPITALS', displayName: 'OTHER HOSPITALS' }
        };

        // Department codes mapping
        const deptCodes = {
            'KAYACHIKITSA': 'KC',
            'SHALYA TANTRA': 'ST',
            'SHALAKYA TANTRA': 'SKT',
            'PANCHAKARMA': 'PK',
            'PRASUTI TANTRA & STREE ROGA': 'PTSR',
            'KAUMARABHRITYA': 'KB',
            'LABORATORY': 'LAB',
            'PHARMACY': 'PHM',
            'ATYAYIKA': 'ATY',
            'AYUSH': 'AYU',
            'SCREENING': 'SCR',
            'OTHER HOSPITALS': 'OTH'
        };

        // Department training guidelines
        const departmentGuidelines = {
            'KAYACHIKITSA': 'The intern should be exposed to comprehensive internal medicine practices, diagnosis and management of various systemic disorders, Panchakarma procedures, and classical Ayurvedic treatment protocols. Emphasis should be given to practical training in patient examination, case taking, and therapeutic procedures.',
            'SHALYA TANTRA': 'The intern should receive training in surgical procedures, wound management, pre and post-operative care, and classical surgical techniques as described in Ayurvedic texts. Practical exposure to minor surgical procedures, wound dressing, and surgical instruments handling is essential.',
            'SHALAKYA TANTRA': 'The intern should be trained in ENT, Ophthalmology, and Dentistry procedures as per Ayurvedic principles. Focus should be given to examination techniques, therapeutic procedures for eye, ear, nose, throat, and oral cavity disorders.',
            'PANCHAKARMA': 'The intern should receive comprehensive training in all Panchakarma procedures including Vamana, Virechana, Basti, Nasya, and Raktamokshana. Practical training in preparation of medicines, patient selection, and post-procedural care is mandatory.',
            'PRASUTI TANTRA & STREE ROGA': 'The intern should be exposed to gynecological and obstetric care, antenatal and postnatal management, family planning methods, and treatment of gynecological disorders as per Ayurvedic principles.',
            'KAUMARABHRITYA': 'The intern should receive training in pediatric care, child development, vaccination, nutritional counseling, and management of pediatric disorders according to Ayurvedic pediatric principles.',
            'LABORATORY': 'The intern should be trained in various laboratory investigations, sample collection, processing, and interpretation of results. Knowledge of modern laboratory techniques and their correlation with Ayurvedic diagnostic methods should be emphasized.',
            'PHARMACY': 'The intern should receive practical training in pharmaceutical preparations, quality control, drug standardization, and manufacturing processes of Ayurvedic medicines as per GMP guidelines.',
            'ATYAYIKA': 'The intern should be trained in emergency medical care, first aid, trauma management, and critical care procedures. Integration of Ayurvedic emergency protocols with modern emergency medicine should be emphasized.',
            'AYUSH': 'The intern should receive exposure to integrated healthcare delivery, community health programs, and interdisciplinary approach in patient care involving various AYUSH systems.',
            'SCREENING': 'The intern should be trained in patient screening procedures, triage, preliminary examination, and basic diagnostic skills. Focus should be given to history taking and initial patient assessment.',
            'OTHER HOSPITALS': 'The intern should receive exposure to healthcare delivery in different settings, gain experience in diverse clinical scenarios, and understand healthcare management in various institutional frameworks.'
        };

        // View switching functions
        function switchView(view) {
            currentView = view;
            const adminBtn = document.getElementById('adminViewBtn');
            const hodBtn = document.getElementById('hodViewBtn');
            const adminLoginSection = document.getElementById('adminLoginSection');
            const adminPanel = document.getElementById('adminPanel');
            const adminSections = document.getElementById('adminSections');
            const hodLoginSection = document.getElementById('hodLoginSection');
            const hodPanel = document.getElementById('hodPanel');

            if (view === 'admin') {
                adminBtn.classList.add('active');
                hodBtn.classList.remove('active');
                adminLoginSection.style.display = 'block';
                adminPanel.style.display = currentAdmin ? 'block' : 'none';
                adminSections.style.display = currentAdmin ? 'block' : 'none';
                hodLoginSection.style.display = 'none';
                hodPanel.style.display = 'none';
                currentHOD = null;
            } else {
                adminBtn.classList.remove('active');
                hodBtn.classList.add('active');
                adminLoginSection.style.display = 'none';
                adminPanel.style.display = 'none';
                adminSections.style.display = 'none';
                hodLoginSection.style.display = 'block';
                hodPanel.style.display = 'none';
                currentAdmin = null;
            }
        }

        // Admin login functions
        function adminLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            const errorDiv = document.getElementById('adminLoginError');

            if (!username || !password) {
                errorDiv.textContent = 'Please enter both username and password.';
                errorDiv.style.display = 'block';
                return;
            }

            if (adminCredentials[username] && adminCredentials[username].password === password) {
                currentAdmin = adminCredentials[username];
                document.getElementById('adminLoginSection').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminSections').style.display = 'block';
                document.getElementById('adminRoleName').textContent = currentAdmin.role;
                errorDiv.style.display = 'none';
                
                // Clear login form
                document.getElementById('adminUsername').value = '';
                document.getElementById('adminPassword').value = '';

                // Render data
                renderInterns();
                updateSummaryStats();
            } else {
                errorDiv.textContent = 'Invalid username or password.';
                errorDiv.style.display = 'block';
            }
        }

        function adminLogout() {
            currentAdmin = null;
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminSections').style.display = 'none';
            document.getElementById('adminLoginSection').style.display = 'block';
        }

        // HOD login functions
        function hodLogin() {
            const username = document.getElementById('hodUsername').value.trim();
            const password = document.getElementById('hodPassword').value.trim();
            const errorDiv = document.getElementById('hodLoginError');

            if (!username || !password) {
                errorDiv.textContent = 'Please enter both username and password.';
                errorDiv.style.display = 'block';
                return;
            }

            if (hodCredentials[username] && hodCredentials[username].password === password) {
                currentHOD = hodCredentials[username];
                document.getElementById('hodLoginSection').style.display = 'none';
                document.getElementById('hodPanel').style.display = 'block';
                document.getElementById('hodDeptName').textContent = currentHOD.displayName;
                renderHODPostings();
                errorDiv.style.display = 'none';
                
                // Clear login form
                document.getElementById('hodUsername').value = '';
                document.getElementById('hodPassword').value = '';
            } else {
                errorDiv.textContent = 'Invalid username or password.';
                errorDiv.style.display = 'block';
            }
        }

        function hodLogout() {
            currentHOD = null;
            document.getElementById('hodPanel').style.display = 'none';
            document.getElementById('hodLoginSection').style.display = 'block';
        }

        // HOD functions
        function renderHODPostings() {
            if (!currentHOD) return;

            const hodPostingsDiv = document.getElementById('hodPostings');
            const relevantPostings = [];

            // Find all postings in this HOD's department
            interns.forEach(intern => {
                intern.postings.forEach(posting => {
                    if (posting.department === currentHOD.department) {
                        relevantPostings.push({
                            intern: intern,
                            posting: posting
                        });
                    }
                });
            });

            if (relevantPostings.length === 0) {
                hodPostingsDiv.innerHTML = '<p style="text-align: center; color: #7f8c8d; font-style: italic;">No postings found for your department.</p>';
                return;
            }

            hodPostingsDiv.innerHTML = `
                <h3 style="color: #2c3e50; margin-bottom: 20px;">Postings in ${currentHOD.displayName}</h3>
                <div class="intern-list">
                    ${relevantPostings.map(item => {
                        const posting = item.posting;
                        const intern = item.intern;
                        const isVerified = posting.verification && posting.verification.verified;
                        
                        return `
                            <div class="intern-card">
                                <div class="intern-header">
                                    <div>
                                        <div class="intern-name">${intern.name}</div>
                                        <div class="intern-reg">Reg: ${intern.regNo}</div>
                                    </div>
                                    <span class="verification-badge ${isVerified ? 'verified' : 'not-verified'}">
                                        ${isVerified ? '✓ VERIFIED' : '⚠ NOT VERIFIED'}
                                    </span>
                                </div>

                                <div class="posting-item">
                                    <div class="posting-dept">${posting.department}</div>
                                    <div class="posting-dates">
                                        ${new Date(posting.fromDate).toLocaleDateString()} - 
                                        ${new Date(posting.toDate).toLocaleDateString()}
                                    </div>
                                    <div class="posting-days">${posting.days} days</div>
                                    
                                    ${isVerified ? `
                                        <div style="background: #d5f4e6; padding: 10px; border-radius: 5px; margin: 10px 0;">
                                            <strong>✓ Verified by:</strong> ${posting.verification.verifiedBy}<br>
                                            <strong>Date:</strong> ${new Date(posting.verification.verifiedAt).toLocaleDateString()}<br>
                                            <strong>Time:</strong> ${new Date(posting.verification.verifiedAt).toLocaleTimeString()}
                                        </div>
                                    ` : `
                                        <div style="margin-top: 15px;">
                                            <button class="btn btn-success" onclick="verifyPosting(${intern.id}, ${posting.id})">
                                                Verify Posting
                                            </button>
                                        </div>
                                    `}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function verifyPosting(internId, postingId) {
            if (!currentHOD) return;

            const intern = interns.find(i => i.id === internId);
            if (!intern) return;

            const posting = intern.postings.find(p => p.id === postingId);
            if (!posting) return;

            if (posting.department !== currentHOD.department) {
                alert('You can only verify postings in your own department.');
                return;
            }

            posting.verification = {
                verified: true,
                verifiedBy: currentHOD.displayName + ' HOD',
                verifiedAt: new Date().toISOString()
            };

            saveData();
            renderHODPostings();
            alert('Posting verified successfully!');
        }

        // Utility functions
        function calculateDays(fromDate, toDate) {
            const start = new Date(fromDate);
            const end = new Date(toDate);
            const timeDiff = end.getTime() - start.getTime();
            return Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;
        }

        function saveData() {
            localStorage.setItem('internData', JSON.stringify(interns));
        }

        // Letter generation functions
        function generateSingleLetter() {
            const name = document.getElementById('letterInternName').value.trim();
            const regNo = document.getElementById('letterInternRegNo').value.trim();
            const dept = document.getElementById('letterDept').value;
            const fromDate = document.getElementById('letterFromDate').value;
            const toDate = document.getElementById('letterToDate').value;

            if (!name || !regNo || !dept || !fromDate || !toDate) {
                alert('Please fill in all fields.');
                return;
            }

            if (new Date(fromDate) > new Date(toDate)) {
                alert('From date cannot be later than to date.');
                return;
            }

            const intern = {
                name: name,
                regNo: regNo,
                department: dept,
                fromDate: fromDate,
                toDate: toDate,
                days: calculateDays(fromDate, toDate)
            };

            try {
                const letterContent = generateLetterContent(intern);
                const filename = `Posting_Letter_${intern.name.replace(/\s+/g, '_')}_${intern.regNo}_${deptCodes[dept] || 'DEPT'}.html`;
                downloadLetter(letterContent, filename);
                alert('Posting letter generated successfully!');
            } catch (error) {
                console.error('Letter generation error:', error);
                alert('Error generating letter. Please try again.');
            }
        }

        function addToLetterList() {
            const name = document.getElementById('letterInternName').value.trim();
            const regNo = document.getElementById('letterInternRegNo').value.trim();
            const dept = document.getElementById('letterDept').value;
            const fromDate = document.getElementById('letterFromDate').value;
            const toDate = document.getElementById('letterToDate').value;

            if (!name || !regNo || !dept || !fromDate || !toDate) {
                alert('Please fill in all fields.');
                return;
            }

            if (new Date(fromDate) > new Date(toDate)) {
                alert('From date cannot be later than to date.');
                return;
            }

            const letterItem = {
                id: Date.now(),
                name: name,
                regNo: regNo,
                department: dept,
                fromDate: fromDate,
                toDate: toDate,
                days: calculateDays(fromDate, toDate)
            };

            letterList.push(letterItem);
            renderLetterList();
            clearLetterForm();
            alert('Added to letter list successfully!');
        }

        function clearLetterForm() {
            document.getElementById('letterInternName').value = '';
            document.getElementById('letterInternRegNo').value = '';
            document.getElementById('letterDept').value = '';
            document.getElementById('letterFromDate').value = '';
            document.getElementById('letterToDate').value = '';
        }

        function renderLetterList() {
            const listDiv = document.getElementById('letterList');
            const sectionDiv = document.getElementById('letterListSection');

            if (letterList.length === 0) {
                sectionDiv.style.display = 'none';
                return;
            }

            sectionDiv.style.display = 'block';
            listDiv.innerHTML = letterList.map((item, index) => `
                <div class="letter-list-item">
                    <div>
                        <strong>${item.name}</strong> (${item.regNo}) → ${item.department}<br>
                        <small style="color: #7f8c8d;">
                            ${new Date(item.fromDate).toLocaleDateString()} to ${new Date(item.toDate).toLocaleDateString()} (${item.days} days)
                        </small>
                    </div>
                    <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" onclick="removeFromLetterList(${index})">
                        Remove
                    </button>
                </div>
            `).join('');
        }

        function removeFromLetterList(index) {
            letterList.splice(index, 1);
            renderLetterList();
        }

        function clearLetterList() {
            letterList = [];
            renderLetterList();
        }

        function generateBatchLetters() {
            if (letterList.length === 0) {
                alert('Please add interns to the letter list first.');
                return;
            }

            try {
                let successCount = 0;
                letterList.forEach((intern, index) => {
                    setTimeout(() => {
                        const letterContent = generateLetterContent(intern);
                        const filename = `Posting_Letter_${intern.name.replace(/\s+/g, '_')}_${intern.regNo}_${deptCodes[intern.department] || 'DEPT'}.html`;
                        downloadLetter(letterContent, filename);
                        successCount++;
                        
                        if (successCount === letterList.length) {
                            alert(`Generated ${letterList.length} individual posting letters successfully!`);
                        }
                    }, index * 500); // Delay to avoid browser blocking multiple downloads
                });
            } catch (error) {
                console.error('Batch letter generation error:', error);
                alert('Error generating batch letters. Please try generating individual letters.');
            }
        }

        function generateDepartmentBatchLetters() {
            if (letterList.length === 0) {
                alert('Please add interns to the letter list first.');
                return;
            }

            try {
                // Group by department
                const departmentGroups = {};
                letterList.forEach(intern => {
                    if (!departmentGroups[intern.department]) {
                        departmentGroups[intern.department] = [];
                    }
                    departmentGroups[intern.department].push(intern);
                });

                let successCount = 0;
                const totalDepts = Object.keys(departmentGroups).length;
                
                Object.keys(departmentGroups).forEach((dept, index) => {
                    setTimeout(() => {
                        const interns = departmentGroups[dept];
                        const batchLetterContent = generateDepartmentBatchLetter(dept, interns);
                        const filename = `Batch_Posting_Letter_${deptCodes[dept] || 'DEPT'}.html`;
                        downloadLetter(batchLetterContent, filename);
                        successCount++;
                        
                        if (successCount === totalDepts) {
                            alert(`Generated batch letters for ${totalDepts} departments successfully!`);
                        }
                    }, index * 500); // Delay to avoid browser blocking multiple downloads
                });
            } catch (error) {
                console.error('Department batch letter generation error:', error);
                alert('Error generating department batch letters. Please try again.');
            }
        }

        function generateLetterContent(intern) {
            const currentDate = new Date().toLocaleDateString('en-IN');
            const guidelines = departmentGuidelines[intern.department] || '';
            
            return `
                <div style="font-family: 'Times New Roman', serif; max-width: 800px; margin: 0 auto; padding: 40px; line-height: 1.6;">
                    <div style="text-align: center; border-bottom: 3px double #2c3e50; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #2c3e50; margin-bottom: 5px; font-size: 1.8rem;">JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL</h1>
                        <p style="color: #7f8c8d; margin: 5px 0; font-size: 1.1rem;">VARUR</p>
                        <p style="color: #7f8c8d; margin: 0; font-size: 0.9rem;">
                            Recognized by Ministry of AYUSH, NCISM, New Delhi; Govt of Karnataka and RGUHS Bengaluru
                        </p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <p style="margin: 5px 0;"><strong>From:</strong> The Medical Superintendent</p>
                                <p style="margin: 5px 0;"><strong>Date:</strong> ${currentDate}</p>
                            </div>
                            <div style="text-align: right;">
                                <p style="margin: 5px 0;"><strong>Ref No:</strong> JAGMC/MS/${new Date().getFullYear()}/${String(Date.now()).slice(-4)}</p>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <p style="margin: 5px 0;"><strong>To,</strong></p>
                        <p style="margin: 5px 0;">The Head of Department</p>
                        <p style="margin: 5px 0;">${intern.department}</p>
                        <p style="margin: 5px 0;">Jain AGM Ayurvedic Medical College & Hospital, Varur</p>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <p style="margin: 0;"><strong>Subject:</strong> Posting of Intern - ${intern.name} (${intern.regNo}) to ${intern.department} Department</p>
                    </div>

                    <p style="margin-bottom: 20px;"><strong>Dear Doctor,</strong></p>

                    <div style="text-align: justify; margin-bottom: 25px;">
                        <p style="margin-bottom: 15px;">
                            This is to inform you that <strong>${intern.name}</strong> (Registration No: <strong>${intern.regNo}</strong>) has been posted to your department for rotational internship training with effect from <strong>${new Date(intern.fromDate).toLocaleDateString('en-IN')}</strong> to <strong>${new Date(intern.toDate).toLocaleDateString('en-IN')}</strong> (${intern.days} days).
                        </p>

                        <p style="margin-bottom: 15px;">
                            You are hereby requested to provide the intern with comprehensive clinical training and practical experience in your department. The intern should be given adequate exposure to both theoretical knowledge and hands-on clinical practice to ensure optimal learning outcomes.
                        </p>

                        <p style="margin-bottom: 15px;">
                            <strong>Training Guidelines for ${intern.department}:</strong><br>
                            ${guidelines}
                        </p>

                        <p style="margin-bottom: 15px;">
                            Please ensure that the intern maintains regular attendance, follows the department protocols, and completes all assigned clinical duties satisfactorily. Kindly provide necessary guidance and mentorship to help the intern achieve the learning objectives of the rotational internship program.
                        </p>

                        <p style="margin-bottom: 15px;">
                            Upon completion of the posting period, please provide your assessment and verification of the intern's performance in your department. This will be essential for the intern's final internship completion certificate.
                        </p>

                        <p style="margin-bottom: 15px;">
                            Your cooperation in providing quality training to our intern is highly appreciated.
                        </p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <p style="margin-bottom: 15px;">Thanking you,</p>
                        <p style="margin-bottom: 5px;">Yours faithfully,</p>
                    </div>

                    <div style="margin-top: 40px;">
                        <div style="text-align: left;">
                            <div style="border-top: 2px solid #2c3e50; width: 250px; margin-bottom: 10px;"></div>
                            <p style="margin: 0; font-weight: bold;">MEDICAL SUPERINTENDENT</p>
                            <p style="margin: 0; color: #7f8c8d;">Jain AGM Ayurvedic Medical College & Hospital</p>
                            <p style="margin: 0; color: #7f8c8d;">Varur</p>
                        </div>
                    </div>

                    <div style="margin-top: 30px; padding-top: 15px; border-top: 1px solid #e1e8ed;">
                        <p style="margin: 0; font-size: 0.9em;"><strong>Copy to:</strong></p>
                        <p style="margin: 2px 0; font-size: 0.9em;">1. The Principal, Jain AGM Ayurvedic Medical College, Varur</p>
                        <p style="margin: 2px 0; font-size: 0.9em;">2. The Intern - ${intern.name} (${intern.regNo})</p>
                        <p style="margin: 2px 0; font-size: 0.9em;">3. Office File</p>
                    </div>

                    <div style="text-align: center; margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                        <p style="margin: 0; font-size: 0.8em; color: #7f8c8d;">
                            This is an official communication from Jain AGM Ayurvedic Medical College & Hospital, Varur
                        </p>
                    </div>
                </div>
            `;
        }

        function generateDepartmentBatchLetter(department, interns) {
            const currentDate = new Date().toLocaleDateString('en-IN');
            const guidelines = departmentGuidelines[department] || '';
            
            return `
                <div style="font-family: 'Times New Roman', serif; max-width: 800px; margin: 0 auto; padding: 40px; line-height: 1.6;">
                    <div style="text-align: center; border-bottom: 3px double #2c3e50; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #2c3e50; margin-bottom: 5px; font-size: 1.8rem;">JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL</h1>
                        <p style="color: #7f8c8d; margin: 5px 0; font-size: 1.1rem;">VARUR</p>
                        <p style="color: #7f8c8d; margin: 0; font-size: 0.9rem;">
                            Recognized by Ministry of AYUSH, NCISM, New Delhi; Govt of Karnataka and RGUHS Bengaluru
                        </p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <p style="margin: 5px 0;"><strong>From:</strong> The Medical Superintendent</p>
                                <p style="margin: 5px 0;"><strong>Date:</strong> ${currentDate}</p>
                            </div>
                            <div style="text-align: right;">
                                <p style="margin: 5px 0;"><strong>Ref No:</strong> JAGMC/MS/${new Date().getFullYear()}/${String(Date.now()).slice(-4)}</p>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <p style="margin: 5px 0;"><strong>To,</strong></p>
                        <p style="margin: 5px 0;">The Head of Department</p>
                        <p style="margin: 5px 0;">${department}</p>
                        <p style="margin: 5px 0;">Jain AGM Ayurvedic Medical College & Hospital, Varur</p>
                    </div>

                    <div style="margin-bottom: 25px;">
                        <p style="margin: 0;"><strong>Subject:</strong> Batch Posting of Interns to ${department} Department</p>
                    </div>

                    <p style="margin-bottom: 20px;"><strong>Dear Doctor,</strong></p>

                    <div style="text-align: justify; margin-bottom: 25px;">
                        <p style="margin-bottom: 15px;">
                            This is to inform you that the following interns have been posted to your department for rotational internship training:
                        </p>

                        <div style="margin: 20px 0;">
                            <table style="width: 100%; border-collapse: collapse; border: 2px solid #2c3e50;">
                                <thead style="background: #f8f9fa;">
                                    <tr>
                                        <th style="border: 1px solid #2c3e50; padding: 12px; text-align: left;">S.No.</th>
                                        <th style="border: 1px solid #2c3e50; padding: 12px; text-align: left;">Name</th>
                                        <th style="border: 1px solid #2c3e50; padding: 12px; text-align: left;">Reg. No.</th>
                                        <th style="border: 1px solid #2c3e50; padding: 12px; text-align: center;">From Date</th>
                                        <th style="border: 1px solid #2c3e50; padding: 12px; text-align: center;">To Date</th>
                                        <th style="border: 1px solid #2c3e50; padding: 12px; text-align: center;">Days</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${interns.map((intern, index) => `
                                        <tr>
                                            <td style="border: 1px solid #2c3e50; padding: 10px; text-align: center;">${index + 1}</td>
                                            <td style="border: 1px solid #2c3e50; padding: 10px; font-weight: bold;">${intern.name}</td>
                                            <td style="border: 1px solid #2c3e50; padding: 10px;">${intern.regNo}</td>
                                            <td style="border: 1px solid #2c3e50; padding: 10px; text-align: center;">${new Date(intern.fromDate).toLocaleDateString('en-IN')}</td>
                                            <td style="border: 1px solid #2c3e50; padding: 10px; text-align: center;">${new Date(intern.toDate).toLocaleDateString('en-IN')}</td>
                                            <td style="border: 1px solid #2c3e50; padding: 10px; text-align: center;">${intern.days}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>

                        <p style="margin-bottom: 15px;">
                            You are hereby requested to provide these interns with comprehensive clinical training and practical experience in your department.
                        </p>

                        <p style="margin-bottom: 15px;">
                            <strong>Training Guidelines for ${department}:</strong><br>
                            ${guidelines}
                        </p>

                        <p style="margin-bottom: 15px;">
                            Your cooperation in providing quality training to our interns is highly appreciated.
                        </p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <p style="margin-bottom: 15px;">Thanking you,</p>
                        <p style="margin-bottom: 5px;">Yours faithfully,</p>
                    </div>

                    <div style="margin-top: 40px;">
                        <div style="text-align: left;">
                            <div style="border-top: 2px solid #2c3e50; width: 250px; margin-bottom: 10px;"></div>
                            <p style="margin: 0; font-weight: bold;">MEDICAL SUPERINTENDENT</p>
                            <p style="margin: 0; color: #7f8c8d;">Jain AGM Ayurvedic Medical College & Hospital</p>
                            <p style="margin: 0; color: #7f8c8d;">Varur</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function downloadLetter(content, filename) {
            try {
                const fullContent = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Posting Letter</title></head>
<body>${content}</body></html>`;
                
                const blob = new Blob([fullContent], { type: 'text/html' });
                
                // Check if browser supports download attribute
                if ('download' in document.createElement('a')) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = filename;
                    
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    setTimeout(() => URL.revokeObjectURL(url), 100);
                } else {
                    // Fallback for older browsers
                    const reader = new FileReader();
                    reader.onload = function() {
                        const newWindow = window.open('', '_blank');
                        newWindow.document.write(fullContent);
                        newWindow.document.close();
                    };
                    reader.readAsDataURL(blob);
                }
            } catch (error) {
                console.error('Download error:', error);
                
                // Alternative method - open in new window
                const newWindow = window.open('', '_blank');
                if (newWindow) {
                    newWindow.document.write(`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Posting Letter</title></head>
<body>${content}</body></html>`);
                    newWindow.document.close();
                    alert('Letter opened in new window. Use Ctrl+S to save or print.');
                } else {
                    alert('Please allow popups for this site to download letters, or copy the content from the modal.');
                    // Show content in modal as fallback
                    document.getElementById('reportContent').innerHTML = content;
                    document.getElementById('reportModal').style.display = 'block';
                }
            }
        }

        // Intern management functions
        function addIntern() {
            const name = document.getElementById('internName').value.trim();
            const regNo = document.getElementById('internRegNo').value.trim();
            
            if (!name || !regNo) {
                alert('Please fill in both name and registration number.');
                return;
            }

            if (interns.some(intern => intern.regNo === regNo)) {
                alert('Registration number already exists!');
                return;
            }

            const intern = {
                id: Date.now(),
                name: name,
                regNo: regNo,
                postings: [],
                totalDays: 0,
                createdDate: new Date().toISOString()
            };

            interns.push(intern);
            saveData();
            renderInterns();
            updateSummaryStats();
            
            document.getElementById('internName').value = '';
            document.getElementById('internRegNo').value = '';
            
            alert('Intern added successfully!');
        }

        function renderInterns() {
            const container = document.getElementById('internList');
            const searchTerm = document.getElementById('searchIntern').value.toLowerCase();
            
            const filteredInterns = interns.filter(intern => 
                intern.name.toLowerCase().includes(searchTerm) || 
                intern.regNo.toLowerCase().includes(searchTerm)
            );

            if (filteredInterns.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #7f8c8d; font-style: italic;">No interns found.</p>';
                return;
            }

            container.innerHTML = filteredInterns.map(intern => {
                const progress = (intern.totalDays / 365) * 100;
                const isCompleted = intern.totalDays >= 365;
                const remainingDays = Math.max(0, 365 - intern.totalDays);

                return `
                    <div class="intern-card">
                        <div class="intern-header">
                            <div>
                                <div class="intern-name">${intern.name}</div>
                                <div class="intern-reg">Reg: ${intern.regNo}</div>
                            </div>
                            <span class="status-badge ${isCompleted ? 'status-completed' : 'status-pending'}">
                                ${isCompleted ? 'COMPLETED' : 'PENDING'}
                            </span>
                        </div>

                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(progress, 100)}%">
                                ${Math.round(progress)}%
                            </div>
                        </div>

                        <div style="margin: 10px 0;">
                            <strong>Total Days:</strong> ${intern.totalDays}/365 days<br>
                            ${!isCompleted ? `<strong>Remaining:</strong> ${remainingDays} days<br>` : ''}
                            <strong>Departments Posted:</strong> ${intern.postings.length}/12
                        </div>

                        <div style="max-height: 200px; overflow-y: auto;">
                            ${intern.postings.map(posting => {
                                const isVerified = posting.verification && posting.verification.verified;
                                return `
                                    <div class="posting-item">
                                        <div class="posting-dept">
                                            ${posting.department}
                                            <span class="verification-badge ${isVerified ? 'verified' : 'not-verified'}">
                                                ${isVerified ? '✓' : '⚠'}
                                            </span>
                                        </div>
                                        <div class="posting-dates">
                                            ${new Date(posting.fromDate).toLocaleDateString()} - 
                                            ${new Date(posting.toDate).toLocaleDateString()}
                                        </div>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <span class="posting-days">${posting.days} days</span>
                                            <button class="btn btn-danger" style="padding: 2px 8px; font-size: 0.7rem;" 
                                                    onclick="deletePosting(${intern.id}, ${posting.id})">Delete</button>
                                        </div>
                                        ${isVerified ? `
                                            <div style="font-size: 0.8rem; color: #27ae60; margin-top: 5px;">
                                                Verified by ${posting.verification.verifiedBy} on ${new Date(posting.verification.verifiedAt).toLocaleDateString()}
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>

                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="openAddPostingModal(${intern.id})">Add Posting</button>
                            <button class="btn btn-success" onclick="generateReport(${intern.id})">View Report</button>
                            <button class="btn btn-secondary" onclick="downloadReport(${intern.id}, 'html')">Download HTML</button>
                            <button class="btn btn-secondary" onclick="downloadReport(${intern.id}, 'json')">Download JSON</button>
                            <button class="btn btn-danger" onclick="deleteIntern(${intern.id})">Delete Intern</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterInterns() {
            renderInterns();
        }

        function updateSummaryStats() {
            const total = interns.length;
            const completed = interns.filter(i => i.totalDays >= 365).length;
            const pending = total - completed;
            const avgProgress = total > 0 ? (interns.reduce((sum, i) => sum + Math.min((i.totalDays / 365) * 100, 100), 0) / total) : 0;

            document.getElementById('totalInterns').textContent = total;
            document.getElementById('completedInterns').textContent = completed;
            document.getElementById('pendingInterns').textContent = pending;
            document.getElementById('avgProgress').textContent = `${avgProgress.toFixed(1)}%`;
        }

        function openAddPostingModal(internId) {
            currentInternId = internId;
            const intern = interns.find(i => i.id === internId);
            
            document.getElementById('modalInternInfo').innerHTML = `
                <strong>Adding posting for:</strong> ${intern.name} (${intern.regNo})
            `;
            
            document.getElementById('addPostingModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('addPostingModal').style.display = 'none';
            document.getElementById('postingDept').value = '';
            document.getElementById('postingFromDate').value = '';
            document.getElementById('postingToDate').value = '';
            currentInternId = null;
        }

        function savePosting() {
            const dept = document.getElementById('postingDept').value;
            const fromDate = document.getElementById('postingFromDate').value;
            const toDate = document.getElementById('postingToDate').value;

            if (!dept || !fromDate || !toDate) {
                alert('Please fill in all fields.');
                return;
            }

            if (new Date(fromDate) > new Date(toDate)) {
                alert('From date cannot be later than to date.');
                return;
            }

            const intern = interns.find(i => i.id === currentInternId);
            
            if (intern.postings.some(p => p.department === dept)) {
                alert('This intern already has a posting in this department.');
                return;
            }

            const days = calculateDays(fromDate, toDate);
            
            const posting = {
                id: Date.now(),
                department: dept,
                fromDate: fromDate,
                toDate: toDate,
                days: days,
                verification: null
            };

            intern.postings.push(posting);
            intern.totalDays = intern.postings.reduce((sum, p) => sum + p.days, 0);

            saveData();
            renderInterns();
            updateSummaryStats();
            closeModal();
            
            alert(`Posting added successfully! ${days} days recorded.`);
        }

        function deletePosting(internId, postingId) {
            if (confirm('Are you sure you want to delete this posting?')) {
                const intern = interns.find(i => i.id === internId);
                intern.postings = intern.postings.filter(p => p.id !== postingId);
                intern.totalDays = intern.postings.reduce((sum, p) => sum + p.days, 0);
                
                saveData();
                renderInterns();
                updateSummaryStats();
            }
        }

        function deleteIntern(internId) {
            if (confirm('Are you sure you want to delete this intern and all their postings?')) {
                interns = interns.filter(i => i.id !== internId);
                saveData();
                renderInterns();
                updateSummaryStats();
            }
        }

        function generateReport(internId) {
            const intern = interns.find(i => i.id === internId);
            const progress = (intern.totalDays / 365) * 100;
            const remainingDays = Math.max(0, 365 - intern.totalDays);
            
            const reportContent = `
                <div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px;">
                    <div style="text-align: center; border-bottom: 3px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #2c3e50; margin-bottom: 10px;">JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR</h1>
                        <h2 style="color: #3498db; margin-bottom: 5px;">INTERNSHIP COMPLETION CERTIFICATE</h2>
                        <p style="color: #7f8c8d;">Official Documentation of Rotational Internship</p>
                    </div>

                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                        <h3 style="color: #2c3e50; margin-bottom: 15px;">INTERN DETAILS</h3>
                        <p><strong>Name:</strong> ${intern.name}</p>
                        <p><strong>Registration Number:</strong> ${intern.regNo}</p>
                        <p><strong>Total Days Completed:</strong> ${intern.totalDays} days</p>
                        <p><strong>Remaining Days:</strong> ${remainingDays} days</p>
                        <p><strong>Completion Status:</strong> 
                            <span style="color: ${intern.totalDays >= 365 ? '#27ae60' : '#f39c12'}; font-weight: bold;">
                                ${intern.totalDays >= 365 ? 'COMPLETED' : 'PENDING'}
                            </span>
                        </p>
                        <p><strong>Progress:</strong> ${progress.toFixed(1)}%</p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h3 style="color: #2c3e50; margin-bottom: 20px;">DEPARTMENT-wise POSTING DETAILS</h3>
                        ${intern.postings.map(posting => `
                            <div style="background: white; border: 1px solid #e1e8ed; border-radius: 8px; padding: 15px; margin-bottom: 15px; border-left: 4px solid #3498db;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <strong style="color: #2c3e50; font-size: 1.1em;">${posting.department}</strong>
                                    <span style="background: #3498db; color: white; padding: 4px 10px; border-radius: 15px; font-size: 0.9em;">${posting.days} days</span>
                                </div>
                                <p style="color: #7f8c8d; margin: 5px 0;">
                                    <strong>Period:</strong> ${new Date(posting.fromDate).toLocaleDateString()} to ${new Date(posting.toDate).toLocaleDateString()}
                                </p>
                                
                                ${posting.verification && posting.verification.verified ? `
                                    <div style="background: #d5f4e6; padding: 10px; border-radius: 5px; margin: 10px 0;">
                                        <p style="color: #27ae60; font-weight: bold; margin: 0;">✓ VERIFIED</p>
                                        <p style="color: #27ae60; font-size: 0.9em; margin: 5px 0 0 0;">
                                            Verified by: ${posting.verification.verifiedBy}<br>
                                            Date: ${new Date(posting.verification.verifiedAt).toLocaleDateString()}
                                        </p>
                                    </div>
                                ` : `
                                    <div style="background: #fef9e7; padding: 10px; border-radius: 5px; margin: 10px 0;">
                                        <p style="color: #f39c12; font-weight: bold; margin: 0;">⚠ PENDING VERIFICATION</p>
                                    </div>
                                `}

                                <div style="margin-top: 15px; text-align: center;">
                                    <div style="border-top: 2px solid #2c3e50; width: 200px; margin: 0 auto;"></div>
                                    <p style="margin-top: 8px; font-size: 0.9em; color: #2c3e50;"><strong>HOD Signature & Date</strong></p>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 40px 0;">
                        <div style="text-align: center;">
                            <div style="border-top: 2px solid #2c3e50; width: 200px; margin: 0 auto 10px;"></div>
                            <p style="font-weight: bold; color: #2c3e50;">MEDICAL SUPERINTENDENT</p>
                            <p style="color: #7f8c8d; font-size: 0.9em;">Signature & Date</p>
                        </div>
                        <div style="text-align: center;">
                            <div style="border-top: 2px solid #2c3e50; width: 200px; margin: 0 auto 10px;"></div>
                            <p style="font-weight: bold; color: #2c3e50;">PRINCIPAL</p>
                            <p style="color: #7f8c8d; font-size: 0.9em;">Signature & Date</p>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 30px 0; padding: 20px; background: #ecf0f1; border-radius: 10px;">
                        <p style="font-weight: bold; color: #2c3e50; font-size: 1.1em;">THIS IS AN OFFICIAL DOCUMENT OF THE COLLEGE</p>
                        <p style="color: #7f8c8d; margin-top: 10px;">The details mentioned above are officially verified and authenticated.</p>
                        <p style="color: #7f8c8d; font-size: 0.9em; margin-top: 10px;">
                            Generated on: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}
                        </p>
                    </div>
                </div>
            `;

            document.getElementById('reportContent').innerHTML = reportContent;
            document.getElementById('reportModal').style.display = 'block';
        }

        function closeReportModal() {
            document.getElementById('reportModal').style.display = 'none';
        }

        function downloadReport(internId, format) {
            const intern = interns.find(i => i.id === internId);
            if (!intern) return;

            if (format === 'html') {
                generateReport(internId);
                setTimeout(() => {
                    const content = document.getElementById('reportContent').innerHTML;
                    const blob = new Blob([`
                        <!DOCTYPE html>
                        <html><head><meta charset="UTF-8"><title>${intern.name} - Internship Report</title></head>
                        <body>${content}</body></html>
                    `], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${intern.name}_${intern.regNo}_Internship_Report.html`;
                    a.click();
                    URL.revokeObjectURL(url);
                    closeReportModal();
                }, 100);
            } else if (format === 'json') {
                const data = {
                    intern: intern,
                    generatedOn: new Date().toISOString(),
                    college: "JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR"
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${intern.name}_${intern.regNo}_Data.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        function exportAllData() {
            const data = {
                interns: interns,
                exportedOn: new Date().toISOString(),
                college: "JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR",
                version: "1.0"
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Intern_Data_Backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.interns && Array.isArray(data.interns)) {
                        if (confirm('This will replace all current data. Are you sure?')) {
                            interns = data.interns;
                            saveData();
                            renderInterns();
                            updateSummaryStats();
                            alert('Data imported successfully!');
                        }
                    } else {
                        alert('Invalid file format. Please select a valid backup file.');
                    }
                } catch (error) {
                    alert('Error reading file. Please check the file format.');
                }
            };
            reader.readAsText(file);
        }

        function generateMasterReport() {
            const masterReportContent = `
                <div style="font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px;">
                    <div style="text-align: center; border-bottom: 3px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px;">
                        <h1 style="color: #2c3e50; margin-bottom: 10px;">JAIN AGM AYURVEDIC MEDICAL COLLEGE & HOSPITAL, VARUR</h1>
                        <h2 style="color: #3498db; margin-bottom: 5px;">MASTER INTERNSHIP REPORT</h2>
                        <p style="color: #7f8c8d;">Complete Overview of All Intern Postings</p>
                        <p style="color: #7f8c8d;">Generated on: ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px;">
                        <div style="background: #3498db; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; font-weight: bold;">${interns.length}</div>
                            <div>Total Interns</div>
                        </div>
                        <div style="background: #27ae60; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; font-weight: bold;">${interns.filter(i => i.totalDays >= 365).length}</div>
                            <div>Completed</div>
                        </div>
                        <div style="background: #f39c12; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; font-weight: bold;">${interns.filter(i => i.totalDays < 365).length}</div>
                            <div>Pending</div>
                        </div>
                        <div style="background: #9b59b6; color: white; padding: 20px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 2em; font-weight: bold;">${(interns.reduce((sum, i) => sum + Math.min((i.totalDays / 365) * 100, 100), 0) / (interns.length || 1)).toFixed(1)}%</div>
                            <div>Avg Progress</div>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 30px 0; padding: 20px; background: #ecf0f1; border-radius: 10px;">
                        <p style="font-weight: bold; color: #2c3e50; font-size: 1.1em;">THIS IS AN OFFICIAL DOCUMENT OF THE COLLEGE</p>
                        <p style="color: #7f8c8d; margin-top: 10px;">The details mentioned above are officially verified and authenticated.</p>
                    </div>
                </div>
            `;

            document.getElementById('reportContent').innerHTML = masterReportContent;
            document.getElementById('reportModal').style.display = 'block';
            
            setTimeout(() => {
                const content = document.getElementById('reportContent').innerHTML;
                const blob = new Blob([`
                    <!DOCTYPE html>
                    <html><head><meta charset="UTF-8"><title>Master Internship Report</title></head>
                    <body>${content}</body></html>
                `], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Master_Internship_Report_${new Date().toISOString().split('T')[0]}.html`;
                a.click();
                URL.revokeObjectURL(url);
                closeReportModal();
            }, 100);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            switchView('admin');
            
            window.onclick = function(event) {
                const addModal = document.getElementById('addPostingModal');
                const reportModal = document.getElementById('reportModal');
                if (event.target == addModal) {
                    closeModal();
                }
                if (event.target == reportModal) {
                    closeReportModal();
                }
            };

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    closeReportModal();
                }
            });
        });
    </script>
</body>
</html>
